(function(a){jQuery.fn.auto_upload=function(e){function k(){function c(f){var c={};if(e.start(f.fileName,c)){var d=new XMLHttpRequest;d.onload=function(){e.finish(d.responseText,f.fileName,c)};d.upload.onprogress=function(b){e.progress(b.loaded/b.total,f.fileName,c)};d.onerror=function(b){e.error(name,b,c)};var k=g.attr("method"),m=g.attr("action");d.open(k,m,!0);d.setRequestHeader("Cache-Control","no-cache");d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("X-File-Name",
f.fileName);d.setRequestHeader("X-File-Size",f.fileSize);if(window.FormData){var l=new FormData;a.each(h,function(b,c){l.append(c.name,c.value)});l.append(i,f);d.send(l)}else if(f.getAsBinary){var j="------multipartformboundary"+(new Date).getTime();d.setRequestHeader("content-type","multipart/form-data; boundary="+j);var b="";a.each(h,function(c,a){b+="--"+j+"\r\n";b+='Content-Disposition: form-data; name="'+unescape(encodeURIComponent(a.name))+'"';b+="\r\n\r\n";b+=unescape(encodeURIComponent(a.value));
b+="\r\n"});b+="--"+j+"\r\n";b+='Content-Disposition: form-data; name="'+i+'"; filename="'+unescape(encodeURIComponent(f.fileName))+'"';b+="\r\n";b+="Content-Type: application/octet-stream";b+="\r\n\r\n";b+=f.getAsBinary();b+="\r\n";b+="--"+j+"--";b+="\r\n";d.sendAsBinary(b)}}}var i=a(this).attr("name"),g=a(this.form),h=g.serializeArray();a.each(this.files,function(a,e){c(e,a)});this.form.reset()}function m(){$input=a(this);$form=a(this.form);$input.bind("change",function(){for(var c=this.value.toString();pos=
c.search("\\\\");){if(pos==-1)break;c=c.substr(pos+1)}var i={};e.start(c,i);var g="gp_"+Math.round(Math.random()*1E7),h=a('<iframe name="'+g+'" id="'+g+'" style="display:none"></iframe>').appendTo("body");$form.attr("target",g).one("submit",function(){h.one("load",function(){var a=h.contents().find("html").html();e.finish(a,c,i);setTimeout(function(){h.remove()},10)})}).submit()})}var e=a.extend({},a.fn.auto_upload.defaults,e),n=function(){var a=document.createElement("input");a.type="file";return"multiple"in
a&&typeof File!="undefined"&&(typeof FormData!=="undefined"||typeof FileReader!=="undefined")&&typeof XMLHttpRequest!="undefined"&&typeof(new XMLHttpRequest).upload!="undefined"}();return a(this).each(function(){$this=a(this);n?($this.attr("multiple","multiple"),$this.bind("change.auto_upload",k)):m.call(this);$this.bind("destroy.auto_upload",function(){$this.unbind(".auto_upload")})})};a.fn.auto_upload.defaults={start:function(){return!0},progress:function(){},finish:function(){},error:function(){}}})(jQuery);